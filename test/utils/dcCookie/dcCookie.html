<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dcCookie 工具类测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-container {
            margin-bottom: 30px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
        }
        .test-title {
            background-color: #f5f5f5;
            padding: 10px;
            margin: -20px -20px 20px -20px;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input[type="text"], 
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        pre {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .info-box {
            background-color: #e7f3ff;
            border-left: 6px solid #2196F3;
            padding: 10px;
            margin: 10px 0;
        }
        .warning {
            background-color: #fff3cd;
            border-left: 6px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
        }
        .cookie-list {
            margin-top: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
        }
        .cookie-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        .cookie-item:last-child {
            border-bottom: none;
        }
        .key-col {
            font-weight: bold;
            color: #333;
            word-break: break-all;
        }
        .value-col {
            color: #666;
            word-break: break-all;
            margin-left: 10px;
        }
        .tabs {
            overflow: hidden;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .tab-button {
            background-color: #f1f1f1;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 10px 16px;
            transition: 0.3s;
        }
        .tab-button:hover {
            background-color: #ddd;
        }
        .tab-button.active {
            background-color: #ccc;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border-top: 1px solid #ccc;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>dcCookie 工具类交互式测试</h1>

    <!-- 当前Cookie信息 -->
    <div class="info-box">
        <p><strong>当前页面Cookie:</strong> <span id="currentCookieCount">0</span> 个</p>
        <p><strong>测试说明:</strong> 此工具用于测试Cookie设置、获取和删除功能。注意：此测试中的操作不会影响实际的浏览器Cookie，除非在真实浏览器中运行。</p>
    </div>

    <!-- 标签页容器 -->
    <div class="tabs">
        <button class="tab-button active" onclick="openTab(event, 'basic')">基本操作</button>
        <button class="tab-button" onclick="openTab(event, 'advanced')">高级设置</button>
        <button class="tab-button" onclick="openTab(event, 'list')">所有Cookie</button>
        <button class="tab-button" onclick="openTab(event, 'presets')">预设测试</button>
        <button class="tab-button" onclick="openTab(event, 'allTests')">运行所有测试</button>
    </div>

    <!-- 基本操作标签页 -->
    <div id="basic" class="tab-content active">
        <div class="test-container">
            <div class="test-title">基本Cookie操作</div>
            
            <label for="cookieKey">键名:</label>
            <input type="text" id="cookieKey" placeholder="输入Cookie键名，如: username">
            
            <label for="cookieValue">值:</label>
            <input type="text" id="cookieValue" placeholder="输入Cookie值">
            
            <button onclick="setCookie()">设置 (set)</button>
            <button onclick="getCookie()">获取 (get)</button>
            <button onclick="removeCookie()">删除 (remove)</button>
            <button onclick="clearAllCookies()">清空所有 (removeAll)</button>
            
            <div class="result" id="basicResult"></div>
        </div>
    </div>

    <!-- 高级设置标签页 -->
    <div id="advanced" class="tab-content">
        <div class="test-container">
            <div class="test-title">高级Cookie设置</div>
            
            <label for="advKey">键名:</label>
            <input type="text" id="advKey" placeholder="输入Cookie键名">
            
            <label for="advValue">值:</label>
            <input type="text" id="advValue" placeholder="输入Cookie值">
            
            <label for="expiresDays">有效期 (天):</label>
            <input type="number" id="expiresDays" value="1" min="-1" step="0.1" placeholder="过期天数，0表示会话Cookie，-1表示立即过期">
            
            <label for="path">路径:</label>
            <input type="text" id="path" value="/" placeholder="/ 或 /admin 等">
            
            <label for="domain">域:</label>
            <input type="text" id="domain" placeholder="example.com（可选）">
            
            <label for="secure">安全标志 (Secure):</label>
            <select id="secure">
                <option value="false">否</option>
                <option value="true">是</option>
            </select>
            
            <button onclick="setAdvancedCookie()">设置高级Cookie</button>
            <button onclick="resetAdvancedForm()">重置</button>
            
            <div class="result" id="advancedResult"></div>
        </div>
    </div>

    <!-- 所有Cookie标签页 -->
    <div id="list" class="tab-content">
        <div class="test-container">
            <div class="test-title">所有Cookie列表</div>
            
            <button onclick="refreshCookieList()">刷新列表</button>
            <button onclick="copyAllCookies()">复制所有Cookie</button>
            <button onclick="exportCookies()">导出JSON</button>
            <button onclick="importCookies()">导入JSON</button>
            
            <div class="cookie-list" id="cookieList">
                <div class="cookie-item">
                    <span class="key-col">暂无数据</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 预设测试标签页 -->
    <div id="presets" class="tab-content">
        <div class="test-container">
            <div class="test-title">预设测试用例</div>
            
            <button onclick="runStringTest()">字符串测试</button>
            <button onclick="runNumberTest()">数字测试</button>
            <button onclick="runBooleanTest()">布尔值测试</button>
            <button onclick="runObjectTest()">对象测试</button>
            <button onclick="runArrayTest()">数组测试</button>
            <button onclick="runEdgeCaseTest()">边界情况测试</button>
            <button onclick="runPerformanceTest()">性能测试</button>
            
            <div class="result" id="presetResult"></div>
        </div>
    </div>

    <!-- 运行所有测试标签页 -->
    <div id="allTests" class="tab-content">
        <div class="test-container">
            <div class="test-title">运行所有测试</div>
            
            <button onclick="runAllTests()">执行全部自动化测试</button>
            
            <div class="result" id="allTestsResult"></div>
        </div>
    </div>

    <!-- 使用说明 -->
    <div class="info-box">
        <h3>使用说明</h3>
        <ul>
            <li><strong>基本操作</strong>: 设置、获取和删除单个Cookie</li>
            <li><strong>高级设置</strong>: 可以设置有效期、路径、域和安全标志等高级属性</li>
            <li><strong>所有Cookie</strong>: 查看当前存储的所有Cookie</li>
            <li><strong>预设测试</strong>: 运行一系列预定义的测试用例来验证功能完整性</li>
            <li><strong>运行所有测试</strong>: 自动运行所有测试用例</li>
            <li>在真实浏览器中，Cookie会保存在浏览器中，但在本测试页面中，由于是模拟环境，刷新页面后数据会丢失</li>
        </ul>
    </div>

    <script src="../../../src/utils/dcCookie.js"></script>
    <script>
        // 页面加载时初始化
        window.onload = function() {
            refreshCookieList();
            updateCurrentCookieCount();
        };

        // 切换标签页
        function openTab(evt, tabName) {
            var i, tabcontent, tabbuttons;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].className = tabcontent[i].className.replace(" active", "");
            }
            tabbuttons = document.getElementsByClassName("tab-button");
            for (i = 0; i < tabbuttons.length; i++) {
                tabbuttons[i].className = tabbuttons[i].className.replace(" active", "");
            }
            document.getElementById(tabName).className += " active";
            evt.currentTarget.className += " active";
        }

        // 更新当前Cookie数量显示
        function updateCurrentCookieCount() {
            const allCookies = dcCookie.getAll();
            document.getElementById('currentCookieCount').textContent = Object.keys(allCookies).length;
        }

        // 设置Cookie
        function setCookie() {
            try {
                const key = document.getElementById('cookieKey').value.trim();
                const value = document.getElementById('cookieValue').value.trim();
                
                if (!key) {
                    throw new Error('键名不能为空');
                }
                
                if (!value) {
                    throw new Error('值不能为空');
                }
                
                dcCookie.set(key, value);
                refreshCookieList();
                updateCurrentCookieCount();
                
                document.getElementById('basicResult').innerHTML = `
                    <p><strong style="color: green">✓ 设置成功！</strong></p>
                    <p><strong>键名:</strong> ${key}</p>
                    <p><strong>值:</strong> ${value}</p>
                `;
                
            } catch (error) {
                document.getElementById('basicResult').innerHTML = `
                    <p><strong style="color: red">✗ 设置失败: ${error.message}</strong></p>
                `;
            }
        }

        // 获取Cookie
        function getCookie() {
            try {
                const key = document.getElementById('cookieKey').value.trim();
                
                if (!key) {
                    throw new Error('键名不能为空');
                }
                
                const value = dcCookie.get(key);
                
                if (value === null) {
                    document.getElementById('basicResult').innerHTML = `
                        <p><strong style="color: orange">⚠ 键名 "${key}" 不存在</strong></p>
                    `;
                } else {
                    document.getElementById('basicResult').innerHTML = `
                        <p><strong style="color: blue">ℹ 获取成功</strong></p>
                        <p><strong>键名:</strong> ${key}</p>
                        <p><strong>值:</strong> ${value}</p>
                    `;
                }
                
            } catch (error) {
                document.getElementById('basicResult').innerHTML = `
                    <p><strong style="color: red">✗ 获取失败: ${error.message}</strong></p>
                `;
            }
        }

        // 删除Cookie
        function removeCookie() {
            try {
                const key = document.getElementById('cookieKey').value.trim();
                
                if (!key) {
                    throw new Error('键名不能为空');
                }
                
                dcCookie.remove(key);
                refreshCookieList();
                updateCurrentCookieCount();
                
                document.getElementById('basicResult').innerHTML = `
                    <p><strong style="color: green">✓ 删除成功！</strong></p>
                    <p><strong>已删除键名:</strong> ${key}</p>
                `;
                
            } catch (error) {
                document.getElementById('basicResult').innerHTML = `
                    <p><strong style="color: red">✗ 删除失败: ${error.message}</strong></p>
                `;
            }
        }

        // 清空所有Cookie
        function clearAllCookies() {
            if (confirm('确定要清空所有Cookie吗？此操作不可撤销！')) {
                dcCookie.removeAll();
                refreshCookieList();
                updateCurrentCookieCount();
                
                document.getElementById('basicResult').innerHTML = `
                    <p><strong style="color: green">✓ 所有Cookie已清空！</strong></p>
                `;
            }
        }

        // 设置高级Cookie
        function setAdvancedCookie() {
            try {
                const key = document.getElementById('advKey').value.trim();
                const value = document.getElementById('advValue').value.trim();
                const expiresDays = parseFloat(document.getElementById('expiresDays').value);
                const path = document.getElementById('path').value.trim();
                const domain = document.getElementById('domain').value.trim() || undefined;
                const secure = document.getElementById('secure').value === 'true';
                
                if (!key) {
                    throw new Error('键名不能为空');
                }
                
                if (!value) {
                    throw new Error('值不能为空');
                }
                
                // 处理有效期
                let expires = null;
                if (!isNaN(expiresDays)) {
                    expires = expiresDays;
                }
                
                dcCookie.set(key, value, expires, path, domain, secure);
                refreshCookieList();
                updateCurrentCookieCount();
                
                document.getElementById('advancedResult').innerHTML = `
                    <p><strong style="color: green">✓ 高级Cookie设置成功！</strong></p>
                    <p><strong>键名:</strong> ${key}</p>
                    <p><strong>值:</strong> ${value}</p>
                    <p><strong>有效期:</strong> ${expires !== null ? expires + ' 天' : '会话Cookie'}</p>
                    <p><strong>路径:</strong> ${path}</p>
                    <p><strong>域:</strong> ${domain || '默认'}</p>
                    <p><strong>安全标志:</strong> ${secure ? '是' : '否'}</p>
                `;
                
            } catch (error) {
                document.getElementById('advancedResult').innerHTML = `
                    <p><strong style="color: red">✗ 设置失败: ${error.message}</strong></p>
                `;
            }
        }

        // 重置高级表单
        function resetAdvancedForm() {
            document.getElementById('advKey').value = '';
            document.getElementById('advValue').value = '';
            document.getElementById('expiresDays').value = '1';
            document.getElementById('path').value = '/';
            document.getElementById('domain').value = '';
            document.getElementById('secure').value = 'false';
            document.getElementById('advancedResult').innerHTML = '';
        }

        // 刷新Cookie列表
        function refreshCookieList() {
            const list = document.getElementById('cookieList');
            const allCookies = dcCookie.getAll();
            
            if (Object.keys(allCookies).length === 0) {
                list.innerHTML = '<div class="cookie-item"><span class="key-col">暂无数据</span></div>';
                return;
            }
            
            list.innerHTML = '';
            
            // 按键名字母顺序排序
            const sortedKeys = Object.keys(allCookies).sort();
            
            sortedKeys.forEach(key => {
                const value = allCookies[key];
                const item = document.createElement('div');
                item.className = 'cookie-item';
                
                const keySpan = document.createElement('span');
                keySpan.className = 'key-col';
                keySpan.textContent = key;
                
                const valueSpan = document.createElement('span');
                valueSpan.className = 'value-col';
                valueSpan.textContent = value;
                
                item.appendChild(keySpan);
                item.appendChild(valueSpan);
                list.appendChild(item);
            });
        }

        // 复制所有Cookie到剪贴板
        function copyAllCookies() {
            const allCookies = dcCookie.getAll();
            
            if (Object.keys(allCookies).length === 0) {
                alert('没有可复制的Cookie');
                return;
            }
            
            let cookieText = '';
            Object.keys(allCookies).forEach(key => {
                cookieText += `${key}=${allCookies[key]}\n`;
            });
            
            navigator.clipboard.writeText(cookieText).then(() => {
                alert(`已复制 ${Object.keys(allCookies).length} 个Cookie到剪贴板`);
            }).catch(err => {
                console.error('复制失败:', err);
                alert('复制失败，请手动选择复制');
            });
        }

        // 导出Cookie为JSON
        function exportCookies() {
            const allCookies = dcCookie.getAll();
            const jsonStr = JSON.stringify(allCookies, null, 2);
            
            // 创建下载链接
            const blob = new Blob([jsonStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cookies-export.json';
            a.click();
            
            // 清理
            setTimeout(() => {
                URL.revokeObjectURL(url);
            }, 100);
        }

        // 导入Cookie从JSON
        function importCookies() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const cookies = JSON.parse(event.target.result);
                        
                        // 清空现有Cookie
                        dcCookie.removeAll();
                        
                        // 导入新Cookie
                        Object.keys(cookies).forEach(key => {
                            dcCookie.set(key, cookies[key]);
                        });
                        
                        refreshCookieList();
                        updateCurrentCookieCount();
                        
                        alert(`成功导入 ${Object.keys(cookies).length} 个Cookie`);
                    } catch (error) {
                        alert('导入失败: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        // 字符串测试
        function runStringTest() {
            try {
                // 清空
                dcCookie.removeAll();
                
                // 测试字符串存储
                dcCookie.set('greeting', 'Hello World');
                dcCookie.set('username', 'john_doe_123');
                dcCookie.set('email', 'user@example.com');
                
                // 验证
                const test1 = dcCookie.get('greeting') === 'Hello World';
                const test2 = dcCookie.get('username') === 'john_doe_123';
                const test3 = dcCookie.get('email') === 'user@example.com';
                
                const allPassed = test1 && test2 && test3;
                
                document.getElementById('presetResult').innerHTML = `
                    <p><strong>字符串测试:</strong> <span style="color: ${allPassed ? 'green' : 'red'}; font-weight: bold;">${allPassed ? '通过' : '失败'}</span></p>
                    <p><strong>测试内容:</strong> 存储和获取多个字符串值</p>
                    <p><strong>详细结果:</strong></p>
                    <ul>
                        <li>问候语: ${test1 ? '✓' : '✗'} (期望: Hello World, 实际: ${dcCookie.get('greeting')})</li>
                        <li>用户名: ${test2 ? '✓' : '✗'} (期望: john_doe_123, 实际: ${dcCookie.get('username')})</li>
                        <li>邮箱: ${test3 ? '✓' : '✗'} (期望: user@example.com, 实际: ${dcCookie.get('email')})</li>
                    </ul>
                `;
                
                refreshCookieList();
                updateCurrentCookieCount();
                
            } catch (error) {
                document.getElementById('presetResult').innerHTML = `
                    <p><strong style="color: red">测试异常: ${error.message}</strong></p>
                `;
            }
        }

        // 数字测试
        function runNumberTest() {
            try {
                // 清空
                dcCookie.removeAll();
                
                // 测试数字存储
                dcCookie.set('count', '42');
                dcCookie.set('price', '99.99');
                dcCookie.set('negative', '-123');
                
                // 验证
                const test1 = dcCookie.get('count') === '42';
                const test2 = dcCookie.get('price') === '99.99';
                const test3 = dcCookie.get('negative') === '-123';
                
                const allPassed = test1 && test2 && test3;
                
                document.getElementById('presetResult').innerHTML = `
                    <p><strong>数字测试:</strong> <span style="color: ${allPassed ? 'green' : 'red'}; font-weight: bold;">${allPassed ? '通过' : '失败'}</span></p>
                    <p><strong>测试内容:</strong> 存储和获取数字值（作为字符串存储）</p>
                    <p><strong>详细结果:</strong></p>
                    <ul>
                        <li>计数: ${test1 ? '✓' : '✗'} (期望: 42, 实际: ${dcCookie.get('count')})</li>
                        <li>价格: ${test2 ? '✓' : '✗'} (期望: 99.99, 实际: ${dcCookie.get('price')})</li>
                        <li>负数: ${test3 ? '✓' : '✗'} (期望: -123, 实际: ${dcCookie.get('negative')})</li>
                    </ul>
                `;
                
                refreshCookieList();
                updateCurrentCookieCount();
                
            } catch (error) {
                document.getElementById('presetResult').innerHTML = `
                    <p><strong style="color: red">测试异常: ${error.message}</strong></p>
                `;
            }
        }

        // 布尔值测试
        function runBooleanTest() {
            try {
                // 清空
                dcCookie.removeAll();
                
                // 测试布尔值存储
                dcCookie.set('isActive', 'true');
                dcCookie.set('isCompleted', 'false');
                
                // 验证
                const test1 = dcCookie.get('isActive') === 'true';
                const test2 = dcCookie.get('isCompleted') === 'false';
                
                const allPassed = test1 && test2;
                
                document.getElementById('presetResult').innerHTML = `
                    <p><strong>布尔值测试:</strong> <span style="color: ${allPassed ? 'green' : 'red'}; font-weight: bold;">${allPassed ? '通过' : '失败'}</span></p>
                    <p><strong>测试内容:</strong> 存储和获取布尔值（作为字符串存储）</p>
                    <p><strong>详细结果:</strong></p>
                    <ul>
                        <li>激活状态: ${test1 ? '✓' : '✗'} (期望: true, 实际: ${dcCookie.get('isActive')})</li>
                        <li>完成状态: ${test2 ? '✓' : '✗'} (期望: false, 实际: ${dcCookie.get('isCompleted')})</li>
                    </ul>
                `;
                
                refreshCookieList();
                updateCurrentCookieCount();
                
            } catch (error) {
                document.getElementById('presetResult').innerHTML = `
                    <p><strong style="color: red">测试异常: ${error.message}</strong></p>
                `;
            }
        }

        // 对象测试
        function runObjectTest() {
            try {
                // 清空
                dcCookie.removeAll();
                
                // 测试对象存储
                const user = {
                    name: 'Alice',
                    age: 30,
                    email: 'alice@example.com'
                };
                
                dcCookie.set('user', JSON.stringify(user));
                
                // 验证
                const storedUser = JSON.parse(dcCookie.get('user') || '{}');
                const test1 = storedUser.name === 'Alice';
                const test2 = storedUser.age === 30;
                const test3 = storedUser.email === 'alice@example.com';
                
                const allPassed = test1 && test2 && test3;
                
                document.getElementById('presetResult').innerHTML = `
                    <p><strong>对象测试:</strong> <span style="color: ${allPassed ? 'green' : 'red'}; font-weight: bold;">${allPassed ? '通过' : '失败'}</span></p>
                    <p><strong>测试内容:</strong> 存储和获取JSON序列化的对象</p>
                    <p><strong>详细结果:</strong></p>
                    <ul>
                        <li>姓名: ${test1 ? '✓' : '✗'} (期望: Alice, 实际: ${storedUser.name})</li>
                        <li>年龄: ${test2 ? '✓' : '✗'} (期望: 30, 实际: ${storedUser.age})</li>
                        <li>邮箱: ${test3 ? '✓' : '✗'} (期望: alice@example.com, 实际: ${storedUser.email})</li>
                    </ul>
                `;
                
                refreshCookieList();
                updateCurrentCookieCount();
                
            } catch (error) {
                document.getElementById('presetResult').innerHTML = `
                    <p><strong style="color: red">测试异常: ${error.message}</strong></p>
                `;
            }
        }

        // 数组测试
        function runArrayTest() {
            try {
                // 清空
                dcCookie.removeAll();
                
                // 测试数组存储
                const numbers = [1, 2, 3, 4, 5];
                const fruits = ['apple', 'banana', 'orange'];
                
                dcCookie.set('numbers', JSON.stringify(numbers));
                dcCookie.set('fruits', JSON.stringify(fruits));
                
                // 验证
                const storedNumbers = JSON.parse(dcCookie.get('numbers') || '[]');
                const storedFruits = JSON.parse(dcCookie.get('fruits') || '[]');
                
                const test1 = Array.isArray(storedNumbers) && storedNumbers.length === 5 && storedNumbers[0] === 1;
                const test2 = Array.isArray(storedFruits) && storedFruits.length === 3 && storedFruits[0] === 'apple';
                
                const allPassed = test1 && test2;
                
                document.getElementById('presetResult').innerHTML = `
                    <p><strong>数组测试:</strong> <span style="color: ${allPassed ? 'green' : 'red'}; font-weight: bold;">${allPassed ? '通过' : '失败'}</span></p>
                    <p><strong>测试内容:</strong> 存储和获取JSON序列化的数组</p>
                    <p><strong>详细结果:</strong></p>
                    <ul>
                        <li>数字数组: ${test1 ? '✓' : '✗'}</li>
                        <li>水果数组: ${test2 ? '✓' : '✗'}</li>
                    </ul>
                `;
                
                refreshCookieList();
                updateCurrentCookieCount();
                
            } catch (error) {
                document.getElementById('presetResult').innerHTML = `
                    <p><strong style="color: red">测试异常: ${error.message}</strong></p>
                `;
            }
        }

        // 边界情况测试
        function runEdgeCaseTest() {
            try {
                // 清空
                dcCookie.removeAll();
                
                let results = [];
                
                // 空键名测试
                try {
                    dcCookie.set('', 'empty key');
                    results.push('<li>空键名: ✓ 成功</li>');
                } catch (e) {
                    results.push(`<li>空键名: ✗ 失败 (${e.message})</li>`);
                }
                
                // 空值测试
                try {
                    dcCookie.set('emptyValue', '');
                    const emptyValue = dcCookie.get('emptyValue');
                    const testEmpty = emptyValue === '';
                    results.push(`<li>空值: ${testEmpty ? '✓' : '✗'} (期望: 空字符串, 实际: '${emptyValue}')`);
                } catch (e) {
                    results.push(`<li>空值: ✗ 异常 (${e.message})</li>`);
                }
                
                // 获取不存在的键
                try {
                    const nonExistent = dcCookie.get('nonexistent_key');
                    const testNonExistent = nonExistent === null;
                    results.push(`<li>不存在的键: ${testNonExistent ? '✓' : '✗'} (期望: null, 实际: ${nonExistent})`);
                } catch (e) {
                    results.push(`<li>不存在的键: ✗ 异常 (${e.message})</li>`);
                }
                
                // 删除不存在的键
                try {
                    dcCookie.remove('nonexistent_remove');
                    results.push('<li>删除不存在的键: ✓ 成功（无异常）</li>');
                } catch (e) {
                    results.push(`<li>删除不存在的键: ✗ 异常 (${e.message})</li>`);
                }
                
                // 特殊字符测试
                try {
                    const specialChars = '!@#$%^&*()_+-={}:<>?,./;\\|[]';
                    dcCookie.set('specialChars', specialChars);
                    const retrieved = dcCookie.get('specialChars');
                    const success = retrieved === specialChars;
                    results.push(`<li>特殊字符: ${success ? '✓' : '✗'}</li>`);
                } catch (e) {
                    results.push(`<li>特殊字符: ✗ 异常 (${e.message})</li>`);
                }
                
                // 中文字符测试
                try {
                    const chinese = '中文测试';
                    dcCookie.set('chinese', chinese);
                    const retrieved = dcCookie.get('chinese');
                    const success = retrieved === chinese;
                    results.push(`<li>中文字符: ${success ? '✓' : '✗'}</li>`);
                } catch (e) {
                    results.push(`<li>中文字符: ✗ 异常 (${e.message})</li>`);
                }
                
                document.getElementById('presetResult').innerHTML = `
                    <p><strong>边界情况测试结果</strong></p>
                    <ul>
                        ${results.join('')}
                    </ul>
                `;
                
                refreshCookieList();
                updateCurrentCookieCount();
                
            } catch (error) {
                document.getElementById('presetResult').innerHTML = `
                    <p><strong style="color: red">测试异常: ${error.message}</strong></p>
                `;
            }
        }

        // 性能测试
        function runPerformanceTest() {
            try {
                const iterations = 1000;
                const start = performance.now();
                
                // 设置大量Cookie
                for (let i = 0; i < iterations; i++) {
                    dcCookie.set(`key_${i}`, `value_${i}`);
                }
                
                const setEnd = performance.now();
                
                // 获取大量Cookie
                for (let i = 0; i < iterations; i++) {
                    dcCookie.get(`key_${i}`);
                }
                
                const end = performance.now();
                const setDuration = setEnd - start;
                const getDuration = end - setEnd;
                const totalDuration = end - start;
                const opsPerSecond = Math.round((iterations * 2) / (totalDuration / 1000));
                
                // 清理
                for (let i = 0; i < iterations; i++) {
                    dcCookie.remove(`key_${i}`);
                }
                
                document.getElementById('presetResult').innerHTML = `
                    <p><strong>性能测试结果:</strong></p>
                    <p><strong>迭代次数:</strong> ${iterations}</p>
                    <p><strong>设置耗时:</strong> ${setDuration.toFixed(2)}ms (${(setDuration/iterations*1000).toFixed(4)}μs/次)</p>
                    <p><strong>获取耗时:</strong> ${getDuration.toFixed(2)}ms (${(getDuration/iterations*1000).toFixed(4)}μs/次)</p>
                    <p><strong>总耗时:</strong> ${totalDuration.toFixed(2)}ms</p>
                    <p><strong>每秒操作数:</strong> ${opsPerSecond.toLocaleString()} ops/s</p>
                    <p><em>测试在当前浏览器环境下进行</em></p>
                `;
                
                refreshCookieList();
                updateCurrentCookieCount();
                
            } catch (error) {
                document.getElementById('presetResult').innerHTML = `
                    <p><strong style="color: red">性能测试失败: ${error.message}</strong></p>
                `;
            }
        }

        // 运行所有测试
        function runAllTests() {
            const results = [];
            
            // 存储原始console.log方法
            const originalLog = console.log;
            let capturedOutput = '';
            
            // 重写console.log以捕获输出
            console.log = function(message) {
                capturedOutput += message + '\n';
                originalLog.apply(console, arguments);
            };
            
            try {
                // 运行Node.js测试
                const nodeTestPassed = require('../../../test/utils/dcCookie/dcCookie.test.js');
                results.push(`<p><strong>Node.js环境测试:</strong> <span style="color: ${nodeTestPassed ? 'green' : 'red'}; font-weight: bold;">${nodeTestPassed ? '通过' : '失败'}</span></p>`);
                
                // 运行浏览器环境测试
                const browserTestPassed = require('../../../test/utils/dcCookie/dcCookie-browser.test.js');
                results.push(`<p><strong>浏览器环境测试:</strong> <span style="color: ${browserTestPassed ? 'green' : 'red'}; font-weight: bold;">${browserTestPassed ? '通过' : '失败'}</span></p>`);
                
            } catch (error) {
                results.push(`<p><strong style="color: red">自动化测试运行失败: ${error.message}</strong></p>`);
            } finally {
                // 恢复原始console.log方法
                console.log = originalLog;
            }
            
            // 运行手动测试用例
            runStringTest();
            runNumberTest();
            runBooleanTest();
            runObjectTest();
            runArrayTest();
            runEdgeCaseTest();
            runPerformanceTest();
            
            document.getElementById('allTestsResult').innerHTML = `
                <h3>自动化测试结果</h3>
                ${results.join('')}
                <h3>手动测试结果</h3>
                <p>请查看"预设测试"标签页中的测试结果</p>
                <p><em>完整测试日志:</em></p>
                <pre>${capturedOutput}</pre>
            `;
        }
    </script>
</body>
</html>