<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DCJS 库验证测试</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      text-align: center;
      color: #333;
    }
    
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    
    .btn {
      background-color: #4CAF50;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    
    .btn:hover {
      background-color: #45a049;
    }
    
    .result {
      margin-top: 15px;
      word-wrap: break-word;
      font-size: 12px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>DCJS 库验证测试</h1>
    
    <div class="test-section">
      <h2>库加载验证</h2>
      <button class="btn" onclick="testLibraryLoad()">测试库加载</button>
      <button class="btn" onclick="testQRCode()">测试二维码功能</button>
      <button class="btn" onclick="testNetworkChecker()">测试网络检测</button>
      <button class="btn" onclick="testArray()">测试数组功能</button>
      <div id="result" class="result"></div>
    </div>
  </div>

  <!-- 使用构建后的版本 -->
  <script src="../dist/dc.js"></script>
  <script>
    function testLibraryLoad() {
      const resultDiv = document.getElementById('result');
      
      if (window.DC) {
        resultDiv.innerHTML = '<p><strong>库加载成功！</strong></p>';
        resultDiv.innerHTML += '<p>可用工具类:</p><ul>';
        
        // 检查所有工具类是否存在
        const tools = [
          'Array', 'Browser', 'Crypto', 'Date', 'Element', 'Files', 
          'Function', 'Media', 'NetworkChecker', 'Number', 'Object', 
          'String', 'Url', 'Validate', 'Platform', 'RegExp', 'adapt', 
          'https', 'infinitescroller', 'json', 'lottery', 'waterfall', 
          'prettylog', 'sampleadapt', 'QRCode'
        ];
        
        tools.forEach(tool => {
          if (window.DC[tool]) {
            resultDiv.innerHTML += `<li style="color: green;">✓ DC.${tool} - 可用</li>`;
          } else {
            resultDiv.innerHTML += `<li style="color: red;">✗ DC.${tool} - 不可用</li>`;
          }
        });
        
        resultDiv.innerHTML += '</ul>';
      } else {
        resultDiv.innerHTML = '<p style="color: red;">库加载失败！window.DC 不存在</p>';
      }
    }
    
    function testQRCode() {
      const resultDiv = document.getElementById('result');
      
      try {
        if (window.DC && window.DC.QRCode) {
          const qrCode = new window.DC.QRCode();
          const dataUrl = qrCode.generate('https://example.com');
          
          if (dataUrl && typeof dataUrl === 'string' && dataUrl.startsWith('data:image')) {
            resultDiv.innerHTML = '<p style="color: green;">✓ 二维码功能正常工作</p>';
            resultDiv.innerHTML += `<img src="${dataUrl}" alt="二维码" style="width: 200px; height: 200px; margin-top: 10px;" />`;
          } else {
            resultDiv.innerHTML = '<p style="color: red;">✗ 二维码生成失败</p>';
          }
        } else {
          resultDiv.innerHTML = '<p style="color: red;">✗ QRCode 工具不可用</p>';
        }
      } catch (error) {
        resultDiv.innerHTML = `<p style="color: red;">✗ 二维码测试出错: ${error.message}</p>`;
        console.error('二维码测试出错:', error);
      }
    }
    
    function testNetworkChecker() {
      const resultDiv = document.getElementById('result');
      
      try {
        if (window.DC && window.DC.NetworkChecker) {
          const networkChecker = new window.DC.NetworkChecker();
          
          resultDiv.innerHTML = '<p style="color: green;">✓ 网络检测器创建成功</p>';
          resultDiv.innerHTML += '<p>开始网络连接测试...</p>';
          
          networkChecker.testConnection().then(result => {
            resultDiv.innerHTML += `<p>在线状态: ${result.online ? '是' : '否'}</p>`;
            resultDiv.innerHTML += `<p>平均响应时间: ${result.avgResponseTime}ms</p>`;
          }).catch(error => {
            resultDiv.innerHTML += `<p>网络测试出错: ${error.message}</p>`;
          });
        } else {
          resultDiv.innerHTML = '<p style="color: red;">✗ NetworkChecker 工具不可用</p>';
        }
      } catch (error) {
        resultDiv.innerHTML = `<p style="color: red;">✗ 网络检测测试出错: ${error.message}</p>`;
        console.error('网络检测测试出错:', error);
      }
    }
    
    function testArray() {
      const resultDiv = document.getElementById('result');
      
      try {
        if (window.DC && window.DC.Array) {
          // 测试数组去重功能
          const original = [1, 2, 2, 3, 4, 4, 5];
          const unique = window.DC.Array.unique(original);
          
          // 测试数组扁平化功能
          const nested = [1, [2, [3, 4]]];
          const flat = window.DC.Array.flatten(nested);
          
          if (Array.isArray(unique) && Array.isArray(flat)) {
            resultDiv.innerHTML = '<p style="color: green;">✓ 数组工具正常工作</p>';
            resultDiv.innerHTML += `<p>原数组: [${original.join(', ')}]</p>`;
            resultDiv.innerHTML += `<p>去重后: [${unique.join(', ')}]</p>`;
            resultDiv.innerHTML += `<p>嵌套数组: [1, [2, [3, 4]]]</p>`;
            resultDiv.innerHTML += `<p>扁平化后: [${flat.join(', ')}]</p>`;
          } else {
            resultDiv.innerHTML = '<p style="color: red;">✗ 数组工具返回类型错误</p>';
          }
        } else {
          resultDiv.innerHTML = '<p style="color: red;">✗ Array 工具不可用</p>';
        }
      } catch (error) {
        resultDiv.innerHTML = `<p style="color: red;">✗ 数组测试出错: ${error.message}</p>`;
        console.error('数组测试出错:', error);
      }
    }
  </script>
</body>
</html>